<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Public Messenger</title>
  <style>
    :root {
      --bg: #f2f3f5;
      --fg: #ffffff;
      --text: #222;
      --bubble: #e4e6eb;
    }
    body.dark {
      --bg: #18191a;
      --fg: #242526;
      --text: #ddd;
      --bubble: #3a3b3c;
    }
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100dvh;
      overflow: hidden;
    }
    #app {
      width: 100%;
      max-width: 600px;
      height: 100dvh;
      display: flex;
      flex-direction: column;
      background: var(--fg);
      overflow: hidden;
      position: relative;
    }
    header {
      padding: 10px 16px;
      background: var(--fg);
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      z-index: 2;
    }
    #settings-panel {
      position: fixed;
      top: 0;
      right: -270px;
      width: 270px;
      height: 100dvh;
      background: var(--fg);
      box-shadow: -2px 0 8px rgba(0,0,0,0.3);
      padding: 16px;
      box-sizing: border-box;
      transition: right 0.3s ease;
      display: flex;
      flex-direction: column;
      z-index: 5;
    }
    #settings-panel.show {
      right: 0;
    }
    #settings-panel input, #settings-panel select, #settings-panel button {
      margin-bottom: 12px;
      padding: 8px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
    }
    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      background: var(--bg);
    }
    .message {
      background: var(--bubble);
      color: var(--text);
      padding: 10px 14px;
      margin-bottom: 10px;
      border-radius: 18px;
      max-width: 85%;
      word-wrap: break-word;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    .message .meta {
      font-size: 12px;
      margin-bottom: 4px;
    }
    form {
      display: flex;
      padding: 12px;
      background: var(--fg);
      border-top: 1px solid #ccc;
    }
    form input {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      border-radius: 18px;
      border: 1px solid #ccc;
      margin-right: 8px;
    }
    form button {
      padding: 10px 16px;
      border: none;
      border-radius: 18px;
      background: #007bff;
      color: white;
      font-weight: bold;
    }
    #login {
      max-width: 400px;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #login input, #login button {
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
    }
    .badge {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }
  </style>
</head>
<body>

<div id="app" class="hidden">
  <header>
    <span id="user-display"></span>
    <button id="settings-btn">‚öôÔ∏è</button>
  </header>
  <div id="messages"></div>
  <form id="msg-form">
    <input type="text" id="msg" placeholder="Type a message...">
    <button type="submit">Send</button>
  </form>
</div>

<div id="login">
  <h2>Login / Sign Up</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button id="signup">Sign Up</button>
  <button id="login-btn">Log In</button>
</div>

<div id="settings-panel">
  <label>Title:</label>
  <input type="text" id="title" placeholder="e.g. Chill Gamer">
  <label>Color Badge:</label>
  <select id="badge-color">
    <option value="blue">üîµ Blue</option>
    <option value="red">üî¥ Red</option>
    <option value="green">üü¢ Green</option>
    <option value="purple">üü£ Purple</option>
  </select>
  <button id="save-settings">Save</button>
  <button id="toggle-dark">Toggle Dark Mode</button>
  <button id="logout">Logout</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const config = {
  apiKey: "AIzaSyCJMj0T5Hny_pCmfcwA_BQVU6HU6OX9QXU",
  authDomain: "publicmessenger-1a1a2.firebaseapp.com",
  databaseURL: "https://publicmessenger-1a1a2-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "publicmessenger-1a1a2",
  storageBucket: "publicmessenger-1a1a2.appspot.com",
  messagingSenderId: "786562136202",
  appId: "1:786562136202:web:355d776f74ef55158bd573"
};
firebase.initializeApp(config);
const auth = firebase.auth();
const db = firebase.database();

const $ = id => document.getElementById(id);

const getProfile = () => ({
  title: localStorage.getItem("profileTitle") || "No Title",
  color: localStorage.getItem("profileColor") || "blue"
});

const saveProfile = () => {
  localStorage.setItem("profileTitle", $("title").value.trim().slice(0, 30));
  localStorage.setItem("profileColor", $("badge-color").value);
  $("settings-panel").classList.remove("show");
};

const toggleDark = () => {
  const dark = localStorage.getItem("darkMode") === "true";
  localStorage.setItem("darkMode", !dark);
  document.body.classList.toggle("dark", !dark);
};

if(localStorage.getItem("darkMode") === "true") document.body.classList.add("dark");

$("settings-btn").onclick = () => {
  $("settings-panel").classList.toggle("show");
  $("title").value = localStorage.getItem("profileTitle") || "";
  $("badge-color").value = localStorage.getItem("profileColor") || "blue";
};

$("save-settings").onclick = saveProfile;
$("toggle-dark").onclick = toggleDark;
$("logout").onclick = () => auth.signOut();

$("signup").onclick = () => {
  auth.createUserWithEmailAndPassword($("email").value, $("password").value).catch(alert);
};
$("login-btn").onclick = () => {
  auth.signInWithEmailAndPassword($("email").value, $("password").value).catch(alert);
};

auth.onAuthStateChanged(user => {
  if(user){
    $("login").style.display = "none";
    $("app").classList.remove("hidden");
    $("user-display").innerText = user.email.split("@")[0];
    const ref = db.ref("messages");
    ref.off();
    $("messages").innerHTML = "";
    ref.on("child_added", snap => {
      const { user, text, title, color } = snap.val();
      const div = document.createElement("div");
      div.className = "message";
      const displayTitle = title || "No Title";
      const displayUser = user || "Anonymous";
      const displayColor = color || "gray";
      div.innerHTML = `<div class="meta"><span class="badge" style="background:${displayColor}"></span> <b>[${displayTitle}] ${displayUser}</b></div>${text}`;
      $("messages").appendChild(div);
      $("messages").scrollTop = $("messages").scrollHeight;
    });
  } else {
    $("app").classList.add("hidden");
    $("login").style.display = "flex";
  }
});

$("msg-form").onsubmit = e => {
  e.preventDefault();
  const text = $("msg").value.trim();
  if(!text) return;
  const user = auth.currentUser;
  const { title, color } = getProfile();
  db.ref("messages").push({
    user: user.email.split("@")[0],
    text,
    title: title || "No Title",
    color: color || "gray"
  });
  $("msg").value = "";
};
</script>
</body>
</html>
